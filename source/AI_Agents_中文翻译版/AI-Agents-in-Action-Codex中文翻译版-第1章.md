# AI Agents in Action Codex中文翻译版 · 第1章

## 第1章 代理及其世界

代理（agent）在机器学习和人工智能领域并不是新概念。在强化学习中，代理指的是能够主动决策并学习的智能体；在其他领域中，它更像是代替人类执行某项工作的自动化程序或软件。本章从多个角度拆解代理体系，帮助你理解它们如何被定义、构成与运作。

### 本章内容
- 定义代理这一概念
- 区分代理所依赖的各类组成系统
- 分析“代理时代”兴起的原因
- 拆解 AI 接口的内部结构
- 导览整个代理生态版图

## 1.1 定义代理

可以查阅任何在线词典来了解“agent”的含义。例如，《韦氏词典》给出了如下定义：
- 能够行动或施加力量的实体
- 能够产生或促成某种效果的事物
- 由指挥智能用来实现结果的工具或手段

本书构建强大代理时所使用的“代理”即源自这一词典定义；因此，我们也把“assistant（助手）”视为“agent”的同义词，OpenAI 的 GPT Assistants 等工具同样属于 AI 代理的范畴。之所以避免直接使用“agent”一词，是因为在机器学习的历史中，代理往往意味着自我决策且具备高度自主性。

图 1.1 展示了用户与大型语言模型（LLM）交互的四种典型情境：直接交互、代理/助手代理、代理/助手，以及完全自主代理。它们的区别如下。
- **直接与 LLM 交互**：例如早期的 ChatGPT，用户直接向模型发问，如“请解释代理的定义”，模型便直接作答，不存在任何中间代理。
- **代理/助手代理**：例如通过 ChatGPT 调用 DALL·E 3 生成图像。LLM 会拦截请求并按照任务特性重新组织提示语，例如把“请给我一幅女特工的插画”转换成更适合图像模型的描述。这类代理非常适合帮助用户完成不熟悉的任务或与不同模型对接。
- **代理/助手**：若使用过 ChatGPT 插件或 GPT 助手，就属于这种情形。LLM 事先了解插件/函数的存在，必要时会准备调用它们。在真正执行前，LLM 会征询用户许可；获批后再调用插件，把结果包装成自然语言回复。
- **自主代理**：代理会解释用户需求、制定计划并找出决策点，随后独立执行步骤并做出决定。它可能会在里程碑节点向用户征求反馈，但通常拥有较大的探索和学习空间。由于需要放权，自主代理也带来更多伦理与安全风险。

图 1.1 还用场景化对话说明了这四种模式：从直接让 LLM 解释概念，到由代理重写提示、调用气象 API 获取卡尔加里气温，乃至完全由自主代理筛选邮件、汇报最重要的五封邮件。可以看到，随着代理能力增强，代理在流程中的角色会从“代理用户使用工具”逐渐过渡到“在决策步骤中自主行动”。

为了处理更复杂的问题，往往需要把代理划分为不同的角色或人物设定，每个角色只处理特定任务并具备专门的工具与知识。多个角色协同工作的系统被称为多代理系统。图 1.2 例举了一个包含三名代理的多代理系统：一个控制器（或代理代理）直接对接用户，两个工作代理分别扮演编码者与测试者。控制器负责与用户交互，也可以在获得授权后代替用户运行代码；编码者编写功能，测试者生成单元测试，两者会不断交流并迭代，直至双方对结果满意后提交给用户。

多代理系统既可以完全自主运行，也可以在人工反馈的指导下工作。它与单代理的能力类似但通常被放大：可以并行处理多项任务，彼此交叉评审，从而减少错误。下一节将继续拆解单个代理本身所包含的关键部件，包括人物设定、可用动作、记忆、推理与规划等。

## 1.2 理解代理的组成系统

代理往往由多个组件系统构成，这些组件是代理为了完成目标或任务而调用的工具，也可以用来创造新的任务。它们既可以是简单模块，也可以是复杂系统，大体可分为五类，如图 1.3 所示：人物设定（Profile & Persona）、动作与工具、记忆与知识、推理与评估、规划与反馈。人物设定位于核心，其余系统都围绕着它展开，每个组件还可以细分出不同类型与用途。

> **提示**：代理或助手的“档案”由多个元素组成，其中包括“人物设定”。可以把档案理解为描述代理要完成什么工作、需要哪些工具的一整套说明，而人物设定则偏向角色/系统提示的描述。

图 1.4 深入展示了如何构建代理档案：我们会学习如何明确地定义人物角色及其特征，为代理提供背景和人口统计信息，例如身份、年龄、性别或专业背景；也会比较纯手工、LLM 协助以及依赖数据/进化算法自动生成档案的不同方式，探索基于数据或其他新颖手段构建角色设定的技巧。

图 1.5 则聚焦在动作与工具的组件，强调三类要点。
- **动作目标**：需要搞清楚动作是为了完成任务、探索环境，还是与他者沟通，以便设定清晰的目标。
- **动作空间与影响**：需要了解动作如何影响任务结果、外部环境以及代理的内部状态或自我认知，这有助于做出高效决策。
- **动作生成方式**：动作既可以由人手动指定，也可以从记忆中检索，或按照预定义计划生成。熟悉这些方式能够帮助我们塑造代理行为、提升学习效果。

图 1.6 进一步说明了知识与记忆组件。代理会结合相关背景信息来标注上下文，同时尽量减少 token 消耗。记忆/知识结构既可以统一，也可以采用混合结构，以适配不同的检索方式。其数据格式非常多样：既可以是文本（例如 PDF）、也可以是关系/对象/文档数据库，或者使用向量嵌入以便进行语义相似度搜索，甚至只是简单的列表。代理可以通过增强、语义抽取或压缩等检索操作，把最合适的信息注入上下文。

图 1.7 强调了推理与评估组件。研究与实践都表明 LLM/代理具备一定的推理能力。推理部分可以使用零样本、单样本、少样本、Chain of Thought（逐步思考）、Tree of Thought（思维树）、Skeleton of Thought（骨架式思考）等提示方式，帮助代理在内部“过一遍”任务。评估部分则让代理能够对过程和结果进行自我反思，例如使用自洽性校验或提示链等策略。

图 1.8 展示了规划与反馈组件，它负责组织任务，帮助代理实现更高层级的目标，大致可以分为两类：
- **无反馈规划**：完全自主的代理，自己制定并执行计划，可使用基础规划、顺序规划或结合自动推理和工具使用。
- **有反馈规划**：依据不同来源的输入来监控并调整计划，这些来源可能是环境变化、人工回馈，或者其他 LLM 给出的自适应建设性反馈。

在规划过程中，代理可能采用单路径推理（按部就班完成任务）、序列式推理，或多路径推理（同时探索多种策略并保存高效做法以备后续使用）。外部规划器（可以是代码或其他代理系统）也能参与协作。

无论是代理/助手代理、常规代理还是自主代理，都可能组合使用这些组件。即便不是完全自主的系统，规划能力也能带来显著价值。

## 1.3 代理时代为何崛起

AI 代理和助手迅速从研究领域的热门议题跃迁到主流软件开发实践。工具与平台层出不穷，用以构建并增强代理，对外界而言似乎只是为了抬高某项炫酷技术的价值。但在 ChatGPT 发布后的头几个月里，人们确实发现了提示工程的重要性：通过不断尝试各种提示技巧和模式，可以获得更稳定、更优质的回答。然而，大家也意识到提示工程的能力终究有限。

提示工程仍是直接与 ChatGPT 等 LLM 沟通的好方法，但它通常需要多轮迭代与反思才能达到理想结果。早期的 AutoGPT 等代理系统就是在这样的背景下诞生的，并迅速吸引了社区关注。

图 1.9 展示了 AutoGPT 的原始设计。该自主代理会先从用户目标中推导出一系列任务，再按步骤执行。每完成一轮任务，就会重新评估目标是否达成；若未完成，代理会依据新信息或人工反馈重新规划步骤并更新计划。代理也可以被配置为每次执行任务前都征询一次许可，或每完成若干任务再统一确认。

AutoGPT 首次证明了“规划 + 迭代”在 LLM 中的威力。随后，大量代理系统与框架在社区出现，纷纷采用类似的规划与任务迭代机制。普遍观点认为，对于复杂、多面向的目标，规划、迭代与重复是让 LLM 取得成功的最佳方式。

不过，要让自主代理真正落地，必须信任它的决策过程、护栏/评估机制以及目标定义。这种信任需要时间去建立，因为我们尚未完全理解自主代理的能力边界。

> **提示**：通用人工智能（AGI）通常被定义为可以学习并完成任意人类任务的智能。许多从业者认为，基于自主代理系统的 AGI 是可以达成的目标。

也因此，目前大多数主流、可用于生产的代理工具并非完全自主，但它们仍然可以显著简化使用 GPT（LLM）执行任务的流程。本书将在后续章节继续探讨不同代理形态的实际应用。

## 1.4 拆解 AI 接口

代理范式不仅改变了我们与 LLM 协作的方式，也被视作软件开发与数据处理方式的根本转变。未来的软件和数据系统不再只依赖传统的图形界面（UI）、编程接口（API）或 SQL 等专用查询语言，而是要原生支持自然语言交互。

图 1.10 展示了这种新体系的高层视图，以及 AI 代理所扮演的角色。数据、软件与应用都会适配语义/自然语言接口，代理可以借助这些接口获取数据、与应用互动，甚至与其他代理沟通。这意味着我们与软件的互动方式正转向“自然语言优先”。

所谓 **AI 接口**，本质上是一组函数、工具与数据层，通过自然语言对外暴露服务。过去常用“语义接口”来描述类似方案，但“semantic”一词语义广泛、容易混淆，因此本书统一使用“AI 接口”这一术语。构建 AI 接口可以让代理更可靠地消费这些服务与数据，提升任务完成的准确率，也能打造更值得信赖、更加自主的应用。虽然并非所有软件与数据都适合用 AI 接口包装，但在大量场景中它会成为主流。

图 1.10 还给出了一个典型流程：用户只需以自然语言提出“请生成上一年度销售额的报告”，代理便会
1. 规划并拆解任务（收集数据、标注数据、格式化并生成可视化、呈现报告）；
2. 通过 GPT 数据/函数层以自然语言查询数据库、调用语义函数；
3. 视需要调用外部工具或其他代理（例如自动生成图表的代码）；
4. 最终以自然语言向用户呈现结果。
整个过程中的通信都可以用自然语言完成。

## 1.5 穿越代理生态

GPT 代理彻底改变了用户与开发者处理信息、构建软件和访问数据的方式。几乎每天都会在 GitHub 或论文中出现新的代理框架、组件或接口。对于刚接触代理系统的人来说，要理清它们的关系与用法既庞杂又令人望而生畏。本书后续章节会循序渐进带你穿越这一生态。

## 本章小结

- 代理是一种能够行动、施加力量、产生效果或作为达成结果之工具的实体；在 AI 语境中，它负责自动化地与 LLM 交互。
- “助手”与“代理”同义，涵盖了 OpenAI 的 GPT Assistants 等工具。
- 自主代理能够独立决策，因此与非自主代理的区分至关重要。
- LLM 交互主要有四种：直接交互、代理/助手代理、代理/助手，以及自主代理。
- 多代理系统由多个代理档案协同工作，通常由代理代理统一协调，以完成复杂任务。
- 代理的核心组件包括档案/人物设定、动作、知识/记忆、推理/评估，以及规划/反馈。
- 档案与人物设定会指导代理如何完成任务、如何回答以及其他细节，通常包含背景与人口统计信息。
- 代理可以通过手动指定、记忆回溯或遵循既定计划来生成动作并调用工具。
- 代理依赖多样的知识与记忆结构来优化上下文并减少 token 使用，数据形式可以是文档、数据库或嵌入等。
- 推理与评估系统让代理能够思考并检验解决方案，可结合零样本/单样本/少样本提示等模式。
- 规划与反馈组件通过单路径或多路径推理组织任务，并整合环境、人工等多种反馈。
- AI 代理正在催生新的软件开发范式，推动应用从传统界面转向自然语言接口。
- 了解上述组件与交互方式的演进，有助于我们构建单代理、多代理乃至自主代理系统。
